---
import '../styles/global.css';
import HeroSection from '../components/HeroSection.astro';
import LinkSection from '../components/LinkSection.astro';
import PageBackground from '../components/PageBackground.astro';
import { getCollection, getEntry } from 'astro:content';

const links = await getCollection('links');
const jobboards = links.find((x) => x.slug === 'jobboards');
const wantedly = links.find((x) => x.slug === 'wantedly');

if (!jobboards) {
  throw new Error(
    'jobboards.md が見つかりません。src/content/links/jobboards.md を確認してください。',
  );
}
if (!wantedly) {
  throw new Error(
    'wantedly.md が見つかりません。src/content/links/wantedly.md を確認してください。',
  );
}

const settingsEntry = await getEntry('settings', 'settings');
const settings = settingsEntry?.data;
if (!settings) {
  throw new Error(
    'settings.md が見つかりません。src/content/settings/settings.md を確認してください。',
  );
}

const pageTitle = settings.site.title;
const pageDesc = settings.site.description;

const ogTitle = settings.site.og?.title ?? pageTitle;
const ogDesc = settings.site.og?.description ?? pageDesc;
const ogImage = settings.site.og?.image;

const twCard = settings.site.twitter?.card ?? 'summary';
const twSite = settings.site.twitter?.site;
const twCreator = settings.site.twitter?.creator;

const gaId = settings.analytics?.googleAnalyticsId;

const hero = settings.hero;
const heroFeatures: string[] = hero?.features ?? [];
const companyName = settings.brand?.companyName ?? pageTitle;
const currentYear = new Date().getFullYear();
const baseUrl = import.meta.env.BASE_URL;
const siteUrl = Astro.site ? new URL(baseUrl, Astro.site).toString() : baseUrl;
const ogImageUrl = ogImage ? new URL(ogImage, siteUrl).toString() : undefined;
---

<!doctype html>
<html lang="ja">
  <head>
    <!-- Google tag (gtag.js) -->
    {
      gaId && (
        <>
          <script async src={`https://www.googletagmanager.com/gtag/js?id=${gaId}`}></script>
          <script src={`${import.meta.env.BASE_URL}gtag-init.js`} data-gtag-id={gaId}></script>
        </>
      )
    }
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{pageTitle}</title>

    <meta name="description" content={pageDesc} />
    <link rel="canonical" href={siteUrl} />

    <meta property="og:title" content={ogTitle} />
    <meta property="og:site_name" content={companyName} />
    <meta property="og:description" content={ogDesc} />
    <meta property="og:type" content="website" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    {ogImageUrl && <meta property="og:image" content={ogImageUrl} />}

    <meta name="twitter:card" content={twCard} />
    {ogImageUrl && <meta name="twitter:image" content={ogImageUrl} />}
    {twSite && <meta name="twitter:site" content={twSite} />}
    {twCreator && <meta name="twitter:creator" content={twCreator} />}

    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" href="/favicon-32x32.png" type="image/png" sizes="32x32" />
    <link rel="icon" href="/favicon-16x16.png" type="image/png" sizes="16x16" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;600&family=Murecho:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
  </head>

  <body class="min-h-screen text-stone-900 antialiased">
    <main class="mx-auto max-w-6xl px-4 py-8 sm:px-6 sm:py-12">
      <PageBackground />

      <HeroSection hero={hero} features={heroFeatures} />

      <!-- Sections -->
      <div class="mt-8 sm:mt-10">
        <section id="jobboards" class="scroll-mt-24">
          <LinkSection {...jobboards.data} variant="highlight" />
        </section>

        <div class="section-divider my-6 sm:my-7" aria-hidden="true"></div>

        <section id="wantedly" class="scroll-mt-24">
          <LinkSection {...wantedly.data} variant="muted" />
        </section>
      </div>
    </main>

    <footer class="border-t border-brand-dark/35 bg-brand">
      <div
        class="mx-auto flex max-w-6xl flex-col gap-4 px-4 py-6 text-sm text-white/90 sm:flex-row sm:items-center sm:justify-between sm:px-6"
      >
        <div class="font-medium text-white">
          © {currentYear}
          <a
            href="https://noar.co.jp"
            target="_blank"
            rel="noopener noreferrer nofollow"
            class="ml-1 underline-offset-4 transition hover:underline focus-visible:rounded-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/75"
          >
            {companyName}
          </a>
        </div>
        <nav class="flex flex-wrap items-center gap-3 text-base text-white">
          <a
            class="site-link rounded-full px-4 py-2 text-sm font-medium tracking-wide sm:text-base"
            href="#jobboards"
          >
            求人情報
          </a>
          <a
            class="site-link rounded-full px-4 py-2 text-sm font-medium tracking-wide sm:text-base"
            href="#wantedly"
          >
            Wantedly
          </a>
          <a
            class="site-link rounded-full px-4 py-2 text-sm font-medium tracking-wide sm:text-base"
            href="#"
          >
            トップへ
          </a>
        </nav>
      </div>
    </footer>
  </body>
</html>
