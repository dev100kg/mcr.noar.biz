---
import type { LinkItem } from '../types/content';

interface Props {
  title: string;
  description?: string;
  items: LinkItem[];
  variant?: 'default' | 'highlight' | 'muted';
}

const { title, description, items, variant } = Astro.props as Props;

const sectionVariant = variant ?? 'default';

// enabled=false を除外（省略は true 扱い）
const visibleItems = items.filter((it) => it.enabled !== false);
const linkLabelText = '件';

const formatUrl = (url: string) => {
  try {
    const parsed = new URL(url);
    const path = parsed.pathname === '/' ? '' : parsed.pathname.replace(/\/$/, '');
    return `${parsed.hostname}${path}`;
  } catch {
    return url;
  }
};

const isHighlight = sectionVariant === 'highlight';
const isMuted = sectionVariant === 'muted';

const countBadgeClass = [
  'shrink-0 rounded-full px-3 py-1 text-xs font-semibold ring-1 flex items-center gap-2 tabular-nums',
  isHighlight
    ? 'bg-[#5eb02f]/12 text-[#4a8d25] ring-[#5eb02f]/22'
    : isMuted
      ? 'bg-stone-100/90 text-stone-600 ring-stone-200'
      : 'bg-[#94a3b8]/16 text-[#64748b] ring-[#94a3b8]/24',
].join(' ');

const cardBaseClass = [
  'group block rounded-2xl border bg-white/76 p-4 transition duration-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#5eb02f]/55',
  isHighlight
    ? 'border-[#5eb02f]/18 shadow-[0_10px_24px_rgba(94,176,47,0.08)] hover:-translate-y-0.5 hover:border-[#5eb02f]/30 hover:bg-white/90 hover:shadow-[0_14px_28px_rgba(94,176,47,0.12)]'
    : isMuted
      ? 'border-stone-200/85 bg-white/64 hover:-translate-y-0.5 hover:border-stone-300 hover:bg-white/88 hover:shadow-[0_10px_22px_rgba(41,37,36,0.08)]'
      : 'border-[#94a3b8]/26 hover:-translate-y-0.5 hover:border-[#94a3b8]/42 hover:bg-white/86 hover:shadow-[0_10px_24px_rgba(148,163,184,0.18)]',
].join(' ');

const labelClass =
  'truncate font-semibold text-stone-900 transition-colors group-hover:text-[#4a8d25] group-hover:underline group-hover:underline-offset-4';
const metaTextClass = 'text-stone-500';
const arrowClass =
  'mt-0.5 text-base text-stone-500 transition duration-200 group-hover:translate-x-0.5 group-hover:-translate-y-0.5 group-hover:text-[#4a8d25]';
---

<section
  class={`section-panel section-rise p-5 sm:p-6 ${
    sectionVariant === 'highlight'
      ? 'bg-[#f8fafc]/74'
      : isMuted
        ? 'bg-[#f8fafc]/70'
        : 'bg-white/74'
  }`}
>
  <header class="mb-5 flex items-start justify-between gap-4">
    <div>
      <h2 class="hero-display text-[1.05rem] font-semibold tracking-[0.01em] text-stone-900 sm:text-xl">
        {title}
      </h2>
      {description && <p class="mt-1.5 text-sm leading-relaxed text-stone-600">{description}</p>}
    </div>

    <span class={countBadgeClass}>
      <span class="text-xs font-semibold tabular-nums sm:text-sm">{visibleItems.length}</span>
      <span class="text-[0.6rem] font-medium sm:text-xs">{linkLabelText}</span>
    </span>
  </header>

  {
    visibleItems.length === 0 ? (
      <div class="rounded-xl border border-stone-200 bg-white/82 p-4 text-sm text-stone-600">
        現在、募集中の求人はありません。
      </div>
    ) : (
      <ul class="flex flex-col gap-3.5">
        {visibleItems.map((it) => (
          <li>
            <a
              href={it.url}
              target="_blank"
              rel="noopener noreferrer nofollow"
              class={cardBaseClass}
              title={it.url}
            >
              <div class="flex items-start justify-between gap-3">
                <div class="min-w-0">
                  <div class={labelClass}>{it.label}</div>

                  {it.note && <div class="mt-1 text-sm text-stone-600">{it.note}</div>}

                  {it.tags && it.tags.length > 0 && (
                    <div class="mt-2 flex flex-wrap gap-2">
                      {it.tags.map((tag) => (
                        <span
                          class="inline-flex items-center rounded-full border border-[#5eb02f]/24 bg-[#5eb02f]/10 px-2.5 py-0.5 text-xs font-medium text-[#4a8d25] transition group-hover:border-[#5eb02f]/36 group-hover:bg-[#5eb02f]/16"
                        >
                          {tag}
                        </span>
                      ))}
                    </div>
                  )}
                </div>

                <span class={arrowClass} aria-hidden="true">
                  ↗
                </span>
              </div>

              <div class={`mt-3 text-xs w-full truncate ${metaTextClass}`}>{formatUrl(it.url)}</div>
            </a>
          </li>
        ))}
      </ul>
    )
  }
</section>
